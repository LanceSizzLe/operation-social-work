<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operation: Social Work - World 1: Orientation Ops</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Sans:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --neon-cyan: #00f3ff;
            --neon-blue: #0066ff;
            --neon-purple: #9d00ff;
            --deep-navy: #0a0e27;
            --dark-slate: #1a1f3a;
            --success-green: #00ff9f;
            --warning-amber: #ffaa00;
            --danger-red: #ff3366;
            --text-primary: #e8f4f8;
            --text-secondary: #8ba3b8;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: linear-gradient(135deg, var(--deep-navy) 0%, #0d1428 50%, var(--dark-slate) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Glowing orbs in background */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .orb-1 {
            width: 400px;
            height: 400px;
            background: var(--neon-cyan);
            top: -100px;
            right: -100px;
            animation: float 15s ease-in-out infinite;
        }

        .orb-2 {
            width: 350px;
            height: 350px;
            background: var(--neon-purple);
            bottom: -100px;
            left: -100px;
            animation: float 18s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        #app-container {
            position: relative;
            z-index: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            padding: 30px 20px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 4vw, 3rem);
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .subtitle {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
            color: var(--neon-cyan);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        /* HUD */
        .hud {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .hud-item {
            background: rgba(26, 31, 58, 0.6);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .hud-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-cyan), transparent);
            animation: scanline 3s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .hud-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .hud-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--neon-cyan);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-blue));
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--neon-cyan);
        }

        .energy-fill {
            background: linear-gradient(90deg, var(--success-green), var(--warning-amber));
        }

        /* Main content area */
        #game-area {
            background: rgba(10, 14, 39, 0.7);
            border: 2px solid rgba(0, 243, 255, 0.4);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
            min-height: 500px;
            position: relative;
        }

        .mission-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mission-card {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.8), rgba(10, 14, 39, 0.9));
            border: 2px solid rgba(0, 243, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .mission-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .mission-card:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.4);
            transform: translateY(-5px);
        }

        .mission-card:hover::before {
            left: 100%;
        }

        .mission-card.completed {
            border-color: var(--success-green);
        }

        .mission-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mission-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--neon-cyan);
            margin-bottom: 10px;
        }

        .mission-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .mission-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .mission-status {
            display: inline-block;
            margin-top: 12px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-new {
            background: rgba(0, 243, 255, 0.2);
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
        }

        .status-completed {
            background: rgba(0, 255, 159, 0.2);
            color: var(--success-green);
            border: 1px solid var(--success-green);
        }

        /* Mission briefing */
        .briefing {
            background: rgba(26, 31, 58, 0.8);
            border-left: 4px solid var(--neon-cyan);
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .briefing h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--neon-cyan);
        }

        .briefing p {
            line-height: 1.7;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* Buttons */
        .btn {
            font-family: 'Orbitron', sans-serif;
            padding: 12px 30px;
            border: 2px solid var(--neon-cyan);
            background: rgba(0, 243, 255, 0.1);
            color: var(--neon-cyan);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 243, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            background: rgba(0, 243, 255, 0.2);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-secondary {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        .btn-secondary:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
        }

        /* Game canvas */
        #game-canvas {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: block;
            border-radius: 8px;
        }

        /* Feedback panel */
        .feedback {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.95), rgba(10, 14, 39, 0.95));
            border: 2px solid var(--neon-cyan);
            border-radius: 12px;
            padding: 30px;
            margin-top: 25px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--success-green);
        }

        .feedback.warning h3 {
            color: var(--warning-amber);
        }

        .feedback p {
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .feedback-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Reflection export */
        .reflection-box {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'IBM Plex Sans', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* Timer */
        .timer {
            position: absolute;
            top: 20px;
            right: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 20px var(--neon-cyan);
        }

        .timer.warning {
            color: var(--danger-red);
            animation: pulse 0.5s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-2 {
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #app-container {
                padding: 10px;
            }

            header {
                padding: 20px 10px;
            }

            #game-area {
                padding: 20px;
            }

            .mission-selector {
                grid-template-columns: 1fr;
            }

            .feedback-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div id="app-container">
        <header>
            <h1>Operation: Social Work</h1>
            <p class="subtitle">World 1: Orientation Ops</p>
        </header>

        <!-- HUD -->
        <div class="hud">
            <div class="hud-item">
                <div class="hud-label">Agent</div>
                <div class="hud-value">Casey Casefile</div>
            </div>
            <div class="hud-item">
                <div class="hud-label">XP</div>
                <div class="hud-value"><span id="xp-display">0</span> / 1000</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="xp-bar" style="width: 0%"></div>
                </div>
            </div>
            <div class="hud-item">
                <div class="hud-label">Coins</div>
                <div class="hud-value">ü™ô <span id="coin-display">0</span></div>
            </div>
            <div class="hud-item">
                <div class="hud-label">Energy</div>
                <div class="hud-value"><span id="energy-display">100</span>%</div>
                <div class="progress-bar">
                    <div class="progress-fill energy-fill" id="energy-bar" style="width: 100%"></div>
                </div>
            </div>
        </div>

        <!-- Main game area -->
        <div id="game-area">
            <!-- Mission selection screen -->
            <div id="mission-selection">
                <div class="briefing">
                    <h2>Welcome to the Agency Operations HQ</h2>
                    <p>You are Agent Casey Casefile, a trainee operative beginning your journey through the world of Social Work practice. The Agency HQ has assigned you to <strong>Orientation Ops</strong> ‚Äî your first training wing.</p>
                    <p>Here you'll master the foundations: administration, ethics, POPIA compliance, and professional conduct. Each operation is a 3-5 minute mission that will prepare you for real-world practicum challenges.</p>
                    <p><strong>Select a mission below to begin your training:</strong></p>
                </div>

                <div class="mission-selector">
                    <div class="mission-card" data-mission="1">
                        <div class="mission-number">Mission 1</div>
                        <h3 class="mission-title">Falling Docs</h3>
                        <p class="mission-desc">Sort valid vs invalid POE (Proof of Evidence) items before the timer runs out. Test your ability to identify legitimate documentation under pressure.</p>
                        <span class="mission-status status-new">New Mission</span>
                    </div>

                    <div class="mission-card" data-mission="2">
                        <div class="mission-number">Mission 2</div>
                        <h3 class="mission-title">Red Flag Room</h3>
                        <p class="mission-desc">Navigate a cluttered virtual office and identify ethics breaches. Demonstrate your understanding of professional boundaries and conduct.</p>
                        <span class="mission-status status-new">New Mission</span>
                    </div>

                    <div class="mission-card" data-mission="3">
                        <div class="mission-number">Mission 3</div>
                        <h3 class="mission-title">POPIA Panic</h3>
                        <p class="mission-desc">Make rapid decisions about what counts as confidential information. Master the principles of privacy and data protection in Social Work.</p>
                        <span class="mission-status status-new">New Mission</span>
                    </div>
                </div>
            </div>

            <!-- Mission 1: Falling Docs -->
            <div id="mission-1" class="hidden">
                <div class="briefing">
                    <h2>Mission 1: Falling Docs</h2>
                    <p>Agent Casefile, welcome to your first operation. The Agency's document processing system has malfunctioned, and case files are falling through the grid.</p>
                    <p>Your task: <strong>Sort valid POE (Proof of Evidence) documents from invalid ones</strong> before time runs out. Drag valid documents to the GREEN zone and invalid ones to the RED zone.</p>
                    <p><strong>Valid POE includes:</strong> ID documents, birth certificates, pay slips, utility bills, bank statements, marriage certificates, court orders</p>
                    <p><strong>Invalid items:</strong> Torn/unreadable documents, expired IDs, personal photos, social media posts, hearsay notes</p>
                </div>
                <div class="text-center">
                    <button class="btn" id="start-mission-1"><span>Start Mission</span></button>
                </div>
                <div id="mission-1-game" class="hidden">
                    <div class="timer" id="timer-1">60</div>
                    <div id="pixi-container-1"></div>
                </div>
            </div>

            <!-- Mission 2: Red Flag Room -->
            <div id="mission-2" class="hidden">
                <div class="briefing">
                    <h2>Mission 2: Red Flag Room</h2>
                    <p>You've entered a simulated Social Work office. Something's not right here, Agent. Multiple ethical breaches are present in this workspace.</p>
                    <p>Your task: <strong>Identify all ethics violations</strong> by clicking on them. Look for breaches of confidentiality, boundary violations, unprofessional conduct, and privacy concerns.</p>
                    <p><strong>Time limit:</strong> 90 seconds to find all red flags.</p>
                </div>
                <div class="text-center">
                    <button class="btn" id="start-mission-2"><span>Start Mission</span></button>
                </div>
                <div id="mission-2-game" class="hidden">
                    <div class="timer" id="timer-2">90</div>
                    <div id="pixi-container-2"></div>
                </div>
            </div>

            <!-- Mission 3: POPIA Panic -->
            <div id="mission-3" class="hidden">
                <div class="briefing">
                    <h2>Mission 3: POPIA Panic</h2>
                    <p>The Agency's data security system is under review. Various pieces of information are being assessed for confidentiality status.</p>
                    <p>Your task: <strong>Classify each item</strong> as either CONFIDENTIAL (must be protected) or PUBLIC (can be shared freely). Make your decisions quickly and accurately.</p>
                    <p><strong>Remember POPIA principles:</strong> Personal information of clients must always be protected. Only share information with explicit consent or legal requirement.</p>
                </div>
                <div class="text-center">
                    <button class="btn" id="start-mission-3"><span>Start Mission</span></button>
                </div>
                <div id="mission-3-game" class="hidden">
                    <div id="popia-question-container"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            xp: 0,
            coins: 0,
            energy: 100,
            completedMissions: [],
            currentMission: null
        };

        // Update HUD
        function updateHUD() {
            document.getElementById('xp-display').textContent = gameState.xp;
            document.getElementById('xp-bar').style.width = (gameState.xp / 1000 * 100) + '%';
            document.getElementById('coin-display').textContent = gameState.coins;
            document.getElementById('energy-display').textContent = gameState.energy;
            document.getElementById('energy-bar').style.width = gameState.energy + '%';
        }

        // Add XP with animation
        function addXP(amount) {
            gameState.xp += amount;
            if (gameState.xp > 1000) gameState.xp = 1000;
            updateHUD();
        }

        // Add coins
        function addCoins(amount) {
            gameState.coins += amount;
            updateHUD();
        }

        // Adjust energy
        function adjustEnergy(amount) {
            gameState.energy += amount;
            if (gameState.energy < 0) gameState.energy = 0;
            if (gameState.energy > 100) gameState.energy = 100;
            updateHUD();
        }

        // Mission selection
        document.querySelectorAll('.mission-card').forEach(card => {
            card.addEventListener('click', function() {
                const missionNum = this.dataset.mission;
                showMission(missionNum);
            });
        });

        function showMission(num) {
            document.getElementById('mission-selection').classList.add('hidden');
            document.getElementById('mission-' + num).classList.remove('hidden');
            gameState.currentMission = num;
        }

        function returnToMissionSelect() {
            ['mission-1', 'mission-2', 'mission-3'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById('mission-selection').classList.remove('hidden');
            gameState.currentMission = null;
        }

        // MISSION 1: FALLING DOCS
        let mission1App = null;

        document.getElementById('start-mission-1').addEventListener('click', function() {
            document.getElementById('mission-1-game').classList.remove('hidden');
            this.classList.add('hidden');
            startMission1();
        });

        function startMission1() {
            const container = document.getElementById('pixi-container-1');
            const width = Math.min(800, container.offsetWidth);
            const height = 500;

            mission1App = new PIXI.Application({
                width: width,
                height: height,
                backgroundColor: 0x0a0e27,
                antialias: true
            });

            container.appendChild(mission1App.view);

            // Game variables
            let score = 0;
            let errors = 0;
            let timeLeft = 60;
            let gameActive = true;

            // Document types
            const validDocs = [
                'ID Document',
                'Birth Certificate',
                'Pay Slip',
                'Utility Bill',
                'Bank Statement',
                'Marriage Cert',
                'Court Order'
            ];

            const invalidDocs = [
                'Torn Document',
                'Expired ID',
                'Personal Photo',
                'Social Media',
                'Hearsay Note',
                'Blank Paper',
                'Spam Mail'
            ];

            // Create zones
            const validZone = new PIXI.Graphics();
            validZone.beginFill(0x00ff9f, 0.3);
            validZone.drawRoundedRect(50, height - 80, 150, 60, 10);
            validZone.endFill();
            validZone.lineStyle(2, 0x00ff9f);
            validZone.drawRoundedRect(50, height - 80, 150, 60, 10);
            mission1App.stage.addChild(validZone);

            const validText = new PIXI.Text('VALID', {
                fontFamily: 'Orbitron',
                fontSize: 20,
                fill: 0x00ff9f,
                fontWeight: 'bold'
            });
            validText.x = 125 - validText.width / 2;
            validText.y = height - 55;
            mission1App.stage.addChild(validText);

            const invalidZone = new PIXI.Graphics();
            invalidZone.beginFill(0xff3366, 0.3);
            invalidZone.drawRoundedRect(width - 200, height - 80, 150, 60, 10);
            invalidZone.endFill();
            invalidZone.lineStyle(2, 0xff3366);
            invalidZone.drawRoundedRect(width - 200, height - 80, 150, 60, 10);
            mission1App.stage.addChild(invalidZone);

            const invalidText = new PIXI.Text('INVALID', {
                fontFamily: 'Orbitron',
                fontSize: 20,
                fill: 0xff3366,
                fontWeight: 'bold'
            });
            invalidText.x = width - 125 - invalidText.width / 2;
            invalidText.y = height - 55;
            mission1App.stage.addChild(invalidText);

            // Score display
            const scoreText = new PIXI.Text('Score: 0 | Errors: 0', {
                fontFamily: 'IBM Plex Sans',
                fontSize: 18,
                fill: 0x00f3ff
            });
            scoreText.x = 20;
            scoreText.y = 20;
            mission1App.stage.addChild(scoreText);

            // Document spawning
            const documents = [];
            
            function createDocument() {
                const isValid = Math.random() > 0.5;
                const docList = isValid ? validDocs : invalidDocs;
                const docName = docList[Math.floor(Math.random() * docList.length)];

                const doc = new PIXI.Container();
                doc.userData = { valid: isValid, name: docName };

                const bg = new PIXI.Graphics();
                bg.beginFill(isValid ? 0x1a1f3a : 0x2a1a1a);
                bg.drawRoundedRect(0, 0, 120, 80, 8);
                bg.endFill();
                bg.lineStyle(2, isValid ? 0x00f3ff : 0xff3366);
                bg.drawRoundedRect(0, 0, 120, 80, 8);
                doc.addChild(bg);

                const text = new PIXI.Text(docName, {
                    fontFamily: 'IBM Plex Sans',
                    fontSize: 14,
                    fill: 0xe8f4f8,
                    align: 'center',
                    wordWrap: true,
                    wordWrapWidth: 100
                });
                text.x = 60 - text.width / 2;
                text.y = 40 - text.height / 2;
                doc.addChild(text);

                doc.x = Math.random() * (width - 120);
                doc.y = -100;
                doc.interactive = true;
                doc.buttonMode = true;

                // Drag functionality
                doc.on('pointerdown', onDragStart)
                   .on('pointerup', onDragEnd)
                   .on('pointerupoutside', onDragEnd)
                   .on('pointermove', onDragMove);

                let dragData = null;

                function onDragStart(event) {
                    dragData = event.data;
                    doc.alpha = 0.8;
                    doc.dragging = true;
                }

                function onDragMove() {
                    if (doc.dragging && dragData) {
                        const newPosition = dragData.getLocalPosition(doc.parent);
                        doc.x = newPosition.x - 60;
                        doc.y = newPosition.y - 40;
                    }
                }

                function onDragEnd() {
                    if (doc.dragging) {
                        doc.alpha = 1;
                        doc.dragging = false;
                        checkZone(doc);
                    }
                }

                mission1App.stage.addChild(doc);
                documents.push(doc);
            }

            function checkZone(doc) {
                const inValidZone = doc.x > 50 && doc.x < 200 && doc.y > height - 100;
                const inInvalidZone = doc.x > width - 200 && doc.x < width - 50 && doc.y > height - 100;

                if (inValidZone || inInvalidZone) {
                    const correct = (inValidZone && doc.userData.valid) || (inInvalidZone && !doc.userData.valid);
                    
                    if (correct) {
                        score++;
                        addXP(15);
                        addCoins(5);
                    } else {
                        errors++;
                        adjustEnergy(-5);
                    }

                    scoreText.text = `Score: ${score} | Errors: ${errors}`;
                    mission1App.stage.removeChild(doc);
                    const index = documents.indexOf(doc);
                    if (index > -1) documents.splice(index, 1);
                }
            }

            // Spawn documents periodically
            const spawnInterval = setInterval(() => {
                if (gameActive) createDocument();
            }, 2000);

            // Update falling documents
            mission1App.ticker.add(() => {
                if (!gameActive) return;

                documents.forEach(doc => {
                    if (!doc.dragging) {
                        doc.y += 2;
                        
                        if (doc.y > height) {
                            errors++;
                            scoreText.text = `Score: ${score} | Errors: ${errors}`;
                            mission1App.stage.removeChild(doc);
                            const index = documents.indexOf(doc);
                            if (index > -1) documents.splice(index, 1);
                        }
                    }
                });
            });

            // Timer
            const timerElement = document.getElementById('timer-1');
            const timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 10) {
                    timerElement.classList.add('warning');
                }

                if (timeLeft <= 0) {
                    endMission1(score, errors);
                }
            }, 1000);

            function endMission1(finalScore, finalErrors) {
                gameActive = false;
                clearInterval(spawnInterval);
                clearInterval(timerInterval);

                // Calculate performance
                const accuracy = finalScore / (finalScore + finalErrors) * 100 || 0;
                
                // Show feedback
                const gameArea = document.getElementById('mission-1-game');
                const feedback = document.createElement('div');
                feedback.className = accuracy >= 70 ? 'feedback' : 'feedback warning';
                
                let reflection = '';
                if (accuracy >= 85) {
                    reflection = `Excellent work, Agent! You demonstrated strong attention to detail and rapid decision-making under pressure. Your accuracy of ${accuracy.toFixed(1)}% shows you understand the importance of proper documentation in Social Work. In real practice, this skill is crucial for building credible case files and protecting both clients and yourself professionally.`;
                } else if (accuracy >= 70) {
                    reflection = `Good effort, Agent. You achieved ${accuracy.toFixed(1)}% accuracy, which shows you're developing an eye for valid documentation. Consider taking more time to assess each document before sorting. In real-world practice, accuracy is more important than speed when dealing with proof of evidence.`;
                } else {
                    reflection = `This mission proved challenging, Agent. With ${accuracy.toFixed(1)}% accuracy, there's room for improvement. Remember: valid POE must be current, legible, and officially issued. Take time to review the types of acceptable documentation. In field practice, submitting invalid documents can delay client services and undermine case credibility.`;
                }

                feedback.innerHTML = `
                    <h3>Mission Complete</h3>
                    <p><strong>Final Score:</strong> ${finalScore} documents sorted correctly</p>
                    <p><strong>Errors:</strong> ${finalErrors}</p>
                    <p><strong>Accuracy:</strong> ${accuracy.toFixed(1)}%</p>
                    <p>${reflection}</p>
                    <div class="reflection-box">
                        <strong>Reflection Summary:</strong><br>
                        Mission: Falling Docs (Document Sorting)<br>
                        Performance: ${finalScore}/${finalScore + finalErrors} correct (${accuracy.toFixed(1)}%)<br>
                        Key Learning: Rapid identification of valid proof of evidence under time pressure.<br>
                        ${accuracy >= 70 ? 'Demonstrated competence in administrative accuracy.' : 'Need to strengthen document verification skills.'}
                    </div>
                    <div class="feedback-actions">
                        <button class="btn" onclick="returnToMissionSelect()"><span>Return to Missions</span></button>
                        <button class="btn btn-secondary" onclick="location.reload()"><span>Retry Mission</span></button>
                    </div>
                `;
                
                gameArea.appendChild(feedback);

                if (!gameState.completedMissions.includes(1)) {
                    gameState.completedMissions.push(1);
                    document.querySelector('[data-mission="1"] .mission-status').className = 'mission-status status-completed';
                    document.querySelector('[data-mission="1"] .mission-status').textContent = 'Completed';
                    document.querySelector('[data-mission="1"]').classList.add('completed');
                }
            }
        }

        // MISSION 2: RED FLAG ROOM
        let mission2App = null;

        document.getElementById('start-mission-2').addEventListener('click', function() {
            document.getElementById('mission-2-game').classList.remove('hidden');
            this.classList.add('hidden');
            startMission2();
        });

        function startMission2() {
            const container = document.getElementById('pixi-container-2');
            const width = Math.min(800, container.offsetWidth);
            const height = 600;

            mission2App = new PIXI.Application({
                width: width,
                height: height,
                backgroundColor: 0x0a0e27,
                antialias: true
            });

            container.appendChild(mission2App.view);

            let timeLeft = 90;
            let found = 0;
            const totalFlags = 8;

            // Red flag scenarios
            const redFlags = [
                { x: 100, y: 100, text: 'Client file open\non desk', correct: true, explanation: 'Confidential files should never be left open where others can see them.' },
                { x: 300, y: 120, text: 'Client photo\non wall', correct: true, explanation: 'Displaying client photos violates privacy and confidentiality.' },
                { x: 500, y: 80, text: 'Closed cabinet', correct: false, explanation: 'Properly storing files is correct procedure.' },
                { x: 650, y: 140, text: 'Personal phone\nwith client info', correct: true, explanation: 'Client information should never be stored on personal devices.' },
                { x: 150, y: 300, text: 'Unlocked\ncomputer', correct: true, explanation: 'Computers must be locked when unattended to protect client data.' },
                { x: 400, y: 320, text: 'Coffee mug', correct: false, explanation: 'Just a coffee mug - no ethical concern here!' },
                { x: 600, y: 280, text: 'Client number\non sticky note', correct: true, explanation: 'Contact information should be securely stored, not on visible sticky notes.' },
                { x: 200, y: 450, text: 'Social media\nopen on screen', correct: true, explanation: 'Social media with client information visible is a boundary violation.' },
                { x: 450, y: 480, text: 'Supervision\ncertificate', correct: false, explanation: 'Displaying professional certificates is appropriate.' },
                { x: 650, y: 440, text: 'Discussing client\nin hallway', correct: true, explanation: 'Client information should never be discussed in public spaces.' }
            ];

            // Create office background
            const bg = new PIXI.Graphics();
            bg.beginFill(0x1a1f3a, 0.5);
            bg.drawRect(0, 0, width, height);
            bg.endFill();
            mission2App.stage.addChild(bg);

            // Instructions
            const instructions = new PIXI.Text('Click on ethical violations (Red Flags)', {
                fontFamily: 'Orbitron',
                fontSize: 18,
                fill: 0x00f3ff
            });
            instructions.x = width / 2 - instructions.width / 2;
            instructions.y = 20;
            mission2App.stage.addChild(instructions);

            // Create red flag items
            redFlags.forEach((flag, index) => {
                const container = new PIXI.Container();
                container.x = flag.x;
                container.y = flag.y;
                container.interactive = true;
                container.buttonMode = true;

                const circle = new PIXI.Graphics();
                circle.lineStyle(2, flag.correct ? 0xff3366 : 0x00f3ff);
                circle.beginFill(0x1a1f3a, 0.8);
                circle.drawCircle(0, 0, 40);
                circle.endFill();
                container.addChild(circle);

                const text = new PIXI.Text(flag.text, {
                    fontFamily: 'IBM Plex Sans',
                    fontSize: 11,
                    fill: 0xe8f4f8,
                    align: 'center',
                    wordWrap: true,
                    wordWrapWidth: 70
                });
                text.anchor.set(0.5);
                container.addChild(text);

                container.on('pointerdown', () => {
                    if (flag.correct) {
                        found++;
                        circle.clear();
                        circle.lineStyle(3, 0x00ff9f);
                        circle.beginFill(0x00ff9f, 0.3);
                        circle.drawCircle(0, 0, 40);
                        circle.endFill();
                        container.interactive = false;
                        
                        addXP(20);
                        addCoins(8);

                        if (found === totalFlags) {
                            setTimeout(() => endMission2(found, totalFlags - found), 500);
                        }
                    } else {
                        adjustEnergy(-8);
                        circle.clear();
                        circle.lineStyle(3, 0xff3366);
                        circle.beginFill(0xff3366, 0.3);
                        circle.drawCircle(0, 0, 40);
                        circle.endFill();
                        setTimeout(() => {
                            circle.clear();
                            circle.lineStyle(2, 0x00f3ff);
                            circle.beginFill(0x1a1f3a, 0.8);
                            circle.drawCircle(0, 0, 40);
                            circle.endFill();
                        }, 500);
                    }
                });

                mission2App.stage.addChild(container);
            });

            // Timer
            const timerElement = document.getElementById('timer-2');
            const timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 15) {
                    timerElement.classList.add('warning');
                }

                if (timeLeft <= 0) {
                    endMission2(found, totalFlags - found);
                }
            }, 1000);

            function endMission2(foundCount, missedCount) {
                clearInterval(timerInterval);

                const accuracy = (foundCount / totalFlags) * 100;
                
                const gameArea = document.getElementById('mission-2-game');
                const feedback = document.createElement('div');
                feedback.className = accuracy >= 70 ? 'feedback' : 'feedback warning';
                
                let reflection = '';
                if (accuracy >= 87.5) {
                    reflection = `Outstanding work, Agent! You identified ${foundCount} out of ${totalFlags} ethics violations. Your keen awareness of professional boundaries and confidentiality principles shows strong ethical reasoning. In real practice, this vigilance protects both clients and your professional integrity. Remember: ethical practice isn't just about avoiding problems - it's about actively creating safe, respectful spaces for clients.`;
                } else if (accuracy >= 62.5) {
                    reflection = `Good effort, Agent. You caught ${foundCount} out of ${totalFlags} violations. You're developing ethical awareness, but some boundary issues were missed. In the field, seemingly small breaches - like discussing cases in hallways or leaving files visible - can have serious consequences for client trust and legal compliance. Stay vigilant.`;
                } else {
                    reflection = `This mission highlighted areas for growth, Agent. You found ${foundCount} out of ${totalFlags} violations. Ethical practice requires constant attention to detail. Review the SACSSP Code of Ethics and POPIA requirements. In real settings, ethics breaches can result in professional misconduct charges, so it's essential to strengthen your awareness now.`;
                }

                feedback.innerHTML = `
                    <h3>Mission Complete</h3>
                    <p><strong>Red Flags Found:</strong> ${foundCount} / ${totalFlags}</p>
                    <p><strong>Missed:</strong> ${missedCount}</p>
                    <p><strong>Accuracy:</strong> ${accuracy.toFixed(1)}%</p>
                    <p>${reflection}</p>
                    <div class="reflection-box">
                        <strong>Reflection Summary:</strong><br>
                        Mission: Red Flag Room (Ethics Identification)<br>
                        Performance: ${foundCount}/${totalFlags} violations identified (${accuracy.toFixed(1)}%)<br>
                        Key Learning: Recognizing ethical breaches in professional settings.<br>
                        ${accuracy >= 70 ? 'Demonstrated strong ethical awareness and boundary recognition.' : 'Need to strengthen understanding of confidentiality and professional boundaries.'}
                    </div>
                    <div class="feedback-actions">
                        <button class="btn" onclick="returnToMissionSelect()"><span>Return to Missions</span></button>
                        <button class="btn btn-secondary" onclick="location.reload()"><span>Retry Mission</span></button>
                    </div>
                `;
                
                gameArea.appendChild(feedback);

                if (!gameState.completedMissions.includes(2)) {
                    gameState.completedMissions.push(2);
                    document.querySelector('[data-mission="2"] .mission-status').className = 'mission-status status-completed';
                    document.querySelector('[data-mission="2"] .mission-status').textContent = 'Completed';
                    document.querySelector('[data-mission="2"]').classList.add('completed');
                }
            }
        }

        // MISSION 3: POPIA PANIC
        document.getElementById('start-mission-3').addEventListener('click', function() {
            document.getElementById('mission-3-game').classList.remove('hidden');
            this.classList.add('hidden');
            startMission3();
        });

        function startMission3() {
            const container = document.getElementById('popia-question-container');
            
            const scenarios = [
                { text: "Client's full name and ID number", confidential: true },
                { text: "Agency's office address", confidential: false },
                { text: "Client's HIV status", confidential: true },
                { text: "General service brochure content", confidential: false },
                { text: "Client's home address", confidential: true },
                { text: "Photos of client's children", confidential: true },
                { text: "Agency opening hours", confidential: false },
                { text: "Client's mental health diagnosis", confidential: true },
                { text: "Social worker's professional registration number", confidential: false },
                { text: "Client's financial records", confidential: true },
                { text: "Names of staff members", confidential: false },
                { text: "Details about client's abuse history", confidential: true }
            ];

            let currentQuestion = 0;
            let correct = 0;
            let incorrect = 0;

            function showQuestion() {
                if (currentQuestion >= scenarios.length) {
                    endMission3(correct, incorrect);
                    return;
                }

                const scenario = scenarios[currentQuestion];
                
                container.innerHTML = `
                    <div class="briefing" style="margin: 30px 0;">
                        <h3 style="color: var(--neon-cyan); margin-bottom: 20px;">Scenario ${currentQuestion + 1} of ${scenarios.length}</h3>
                        <p style="font-size: 1.2rem; margin-bottom: 30px;">"${scenario.text}"</p>
                        <p style="color: var(--text-secondary);">Is this information CONFIDENTIAL or can it be shared publicly?</p>
                    </div>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" id="confidential-btn" style="min-width: 200px;"><span>üîí CONFIDENTIAL</span></button>
                        <button class="btn btn-secondary" id="public-btn" style="min-width: 200px;"><span>üåê PUBLIC</span></button>
                    </div>
                    <div style="text-align: center; margin-top: 30px; color: var(--text-secondary);">
                        Score: ${correct} correct | ${incorrect} incorrect
                    </div>
                `;

                document.getElementById('confidential-btn').addEventListener('click', () => handleAnswer(true));
                document.getElementById('public-btn').addEventListener('click', () => handleAnswer(false));
            }

            function handleAnswer(userAnswer) {
                const scenario = scenarios[currentQuestion];
                const isCorrect = userAnswer === scenario.confidential;

                if (isCorrect) {
                    correct++;
                    addXP(25);
                    addCoins(10);
                } else {
                    incorrect++;
                    adjustEnergy(-6);
                }

                // Show immediate feedback
                const feedback = document.createElement('div');
                feedback.style.cssText = 'margin: 20px 0; padding: 15px; border-radius: 8px; text-align: center;';
                feedback.style.background = isCorrect ? 'rgba(0, 255, 159, 0.2)' : 'rgba(255, 51, 102, 0.2)';
                feedback.style.border = isCorrect ? '1px solid var(--success-green)' : '1px solid var(--danger-red)';
                feedback.innerHTML = `
                    <strong style="color: ${isCorrect ? 'var(--success-green)' : 'var(--danger-red)'};">
                        ${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}
                    </strong>
                    <p style="margin-top: 10px; color: var(--text-primary);">
                        This information is <strong>${scenario.confidential ? 'CONFIDENTIAL' : 'PUBLIC'}</strong>.
                        ${scenario.confidential ? 
                            'Under POPIA, this personal information must be protected and only shared with explicit consent or legal requirement.' : 
                            'This general information can be shared publicly as it does not contain personal client data.'}
                    </p>
                `;
                container.appendChild(feedback);

                setTimeout(() => {
                    currentQuestion++;
                    showQuestion();
                }, 2500);
            }

            function endMission3(correctCount, incorrectCount) {
                const total = correctCount + incorrectCount;
                const accuracy = (correctCount / total) * 100;

                let reflection = '';
                if (accuracy >= 90) {
                    reflection = `Exceptional work, Agent! You correctly classified ${correctCount} out of ${total} items. Your understanding of POPIA and confidentiality principles is excellent. In practice, this knowledge protects clients' dignity and rights while keeping you compliant with legal requirements. Remember: when in doubt, always err on the side of protecting client information.`;
                } else if (accuracy >= 75) {
                    reflection = `Solid performance, Agent. You achieved ${accuracy.toFixed(1)}% accuracy in classifying confidential information. You understand the basics of POPIA, but review the distinction between personal client data and general agency information. In the field, improper disclosure - even accidental - can result in legal consequences and loss of client trust.`;
                } else {
                    reflection = `This mission showed significant learning opportunities, Agent. With ${accuracy.toFixed(1)}% accuracy, you need to strengthen your understanding of POPIA and confidentiality. Key principle: ANY information that identifies a client or reveals personal details is confidential. Study the POPIA Act and your agency's confidentiality policy before placement.`;
                }

                container.innerHTML = `
                    <div class="feedback">
                        <h3>Mission Complete</h3>
                        <p><strong>Correct Classifications:</strong> ${correctCount} / ${total}</p>
                        <p><strong>Incorrect:</strong> ${incorrectCount}</p>
                        <p><strong>Accuracy:</strong> ${accuracy.toFixed(1)}%</p>
                        <p>${reflection}</p>
                        <div class="reflection-box">
                            <strong>Reflection Summary:</strong><br>
                            Mission: POPIA Panic (Confidentiality Classification)<br>
                            Performance: ${correctCount}/${total} correct (${accuracy.toFixed(1)}%)<br>
                            Key Learning: Distinguishing confidential personal information from public information.<br>
                            ${accuracy >= 75 ? 'Demonstrated competence in POPIA principles and data protection.' : 'Need to strengthen understanding of confidentiality requirements and POPIA compliance.'}
                        </div>
                        <div class="feedback-actions">
                            <button class="btn" onclick="returnToMissionSelect()"><span>Return to Missions</span></button>
                            <button class="btn btn-secondary" onclick="location.reload()"><span>Retry Mission</span></button>
                        </div>
                    </div>
                `;

                if (!gameState.completedMissions.includes(3)) {
                    gameState.completedMissions.push(3);
                    document.querySelector('[data-mission="3"] .mission-status').className = 'mission-status status-completed';
                    document.querySelector('[data-mission="3"] .mission-status').textContent = 'Completed';
                    document.querySelector('[data-mission="3"]').classList.add('completed');
                }
            }

            showQuestion();
        }

        // Initialize
        updateHUD();
    </script>
</body>
</html>
